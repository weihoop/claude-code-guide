---
name: doc
description: 智能更新项目文档
aliases: [update-doc, docs, documentation]
---

# 智能文档更新流程

自动分析代码变更并更新相关文档，确保文档与代码保持同步。

## 执行步骤

### 1. 分析最近的代码变更

运行以下命令查看最近的改动：
```bash
git diff HEAD~5..HEAD --name-only
```

识别变更的文件类型：
- 源代码文件（.js, .py, .go 等）
- 配置文件（config.yaml, .env.example 等）
- 依赖文件（package.json, requirements.txt 等）

### 2. 识别需要更新的文档

根据代码变更，确定需要更新的文档：

#### README.md 更新时机
- ✅ 添加了新功能
- ✅ 修改了安装步骤
- ✅ 更改了使用方法
- ✅ 修复了重要 bug
- ✅ 更新了依赖项

#### .claude.md 更新时机
- ✅ 项目架构变化
- ✅ 技术栈调整
- ✅ 新增重要模块
- ✅ 开发规范更新
- ✅ 配置文件变更

#### API 文档更新时机
- ✅ 新增或修改 API 接口
- ✅ 修改请求/响应格式
- ✅ 更新认证方式
- ✅ 添加新的错误码

#### 配置文档更新时机
- ✅ 新增配置项
- ✅ 修改默认值
- ✅ 废弃旧配置

### 3. 执行文档更新

对于每个需要更新的文档：

1. **读取当前文档内容**
2. **分析需要更新的章节**
3. **生成更新内容**
   - 保持原有格式和风格
   - 使用清晰的中文描述
   - 提供实际的代码示例
4. **更新文档**
5. **验证更新**
   - 检查 Markdown 格式
   - 验证代码示例可执行性
   - 确保链接有效

### 4. 验证文档质量

检查更新后的文档：
- [ ] 格式正确（Markdown 语法）
- [ ] 代码示例有效
- [ ] 链接可访问
- [ ] 描述清晰准确
- [ ] 与代码一致

### 5. 生成更新报告

输出文档更新摘要：
```markdown
## 文档更新报告

### 更新的文档
- README.md - 添加新功能说明
- .claude.md - 更新项目依赖
- docs/api.md - 新增 2 个 API 端点

### 主要变更
1. 功能说明：添加用户认证功能文档
2. 安装步骤：更新依赖安装命令
3. API 文档：新增登录和注册接口

### 建议
- 考虑添加使用示例
- 更新配置文件示例
```

## 文档更新最佳实践

### 1. 保持同步
- 在提交代码前更新文档
- 使用 `/doc` 命令检查文档状态
- 将文档更新纳入开发流程

### 2. 清晰描述
- 使用简洁的中文
- 提供实际可运行的示例
- 说明参数和返回值

### 3. 版本控制
- 文档与代码一起提交
- 在 CHANGELOG 中记录变更
- 保持文档版本号同步

### 4. 定期审查
- 每个版本发布前审查文档
- 检查过期信息
- 更新示例代码

## 常见文档类型

### 技术文档
- README.md - 项目概述和快速开始
- CONTRIBUTING.md - 贡献指南
- CHANGELOG.md - 变更日志
- API.md - API 接口文档

### 配置文档
- .claude.md - Claude Code 项目配置
- config.example.yaml - 配置示例
- .env.example - 环境变量示例

### 开发文档
- DEVELOPMENT.md - 开发指南
- ARCHITECTURE.md - 架构说明
- TESTING.md - 测试指南

## 自动检测规则

当检测到以下文件变更时，自动提醒更新对应文档：

| 文件变更 | 检查文档 | 更新内容 |
|---------|---------|---------|
| `*.py`, `*.js` | README.md | 功能说明、使用方法 |
| `config.yaml` | README.md, 配置文档 | 配置项说明 |
| `package.json` | README.md | 依赖、安装步骤 |
| `requirements.txt` | README.md | Python 依赖 |
| `api/*.js` | API.md | API 端点 |
| `.claude/*` | .claude.md | 项目配置 |
